import re, sys, os, copy, dataclasses, time, math, itertools
import pulp
from sympy import *
from z3 import *

TEST = True
def main():
    start_time = time.perf_counter()


    # buttons = [
    #  (0,1,5,6,7,8),
    #  (0,2,3,4,7,8,9),
    #  (0,4,7,8),
    #  (1,4,5,7),
    #  (2,3,5,7,9),
    #  (0,2,3,4,6,7,8),
    #  (0,1,2,5,6,8,9),
    #  (1,3,4,7,9),
    #  (0,1,2,3,5,6,8,9),
    #  (0,1,2,3,4,5,9),
    #  (5,8,9),
    #  (1,4,6,8,9),
    #  (0,1,2,3,4,7,8)
    # ]
    buttons = [
        (1,4,5,6,8,9),
        (0,2,4,5,6,9),
        (1,2,3,4,5,6,7,8) ,
        (2,4,6,9) ,
        (3,4,7,8) ,
        (0,4,5,7,8,9) ,
        (0,1,4,6,7,9) ,
        (1,4,5,8,9) ,
        (0,1,2,3,4,6,7,9),
        (1,3,6,7,8,9) ,
        (0,4,5,6,7,8,9) ,
        (0,1,2,4,5,6,7,8)
        ]

    A = [
        [0] * 12,
        [0] * 12,
        [0] * 12,
        [0] * 12,
        [0] * 12,
        [0] * 12,
        [0] * 12,
        [0] * 12,
        [0] * 12,
        [0] * 12
    ]
    for i in range(len(buttons)):
        for j in buttons[i]:
            A[j][i] = 1
    B = [68,87,58,60,110,79,107,106,98,85]

    # mod = pulp.LpProblem('prob')
    # vars = pulp.LpVariable.dicts('x', range(len(A[0])), lowBound=0, cat='Integer')
    # for row, rhs in zip(A, B):
    #     mod += sum([row[i] * vars[i] for i in range(len(row))]) == rhs
    # mod.addConstraint(pulp.LpConstraint())
    # mod.solve()
    # solution = [vars[i].value() for i in range(len(A[0]))]
    # print(solution)
    # print(sum(solution))

    # A = Matrix(A)
    # B = Matrix(B)
    # print(A.nullspace())

    # A = [[1, 2, 1], [3, 1, -1]]
    # b = [20, 12]
    n = len(A[0])  # number of variables
    m = len(B)  # number of constraints

    X = [Int('x%d' % i) for i in range(n)]
    s = Solver()
    s.add(And([X[i] >= 0 for i in range(n)]))
    for i in range(m):
        s.add(Sum([A[i][j] * X[j] for j in range(n)]) == B[i])

    minsol = 10000000000

    while s.check() == sat:
        sol = [s.model().evaluate(X[i]) for i in range(n)]
        print(sol)
        next_sum = sum([n.as_long() for n in sol])
        print(next_sum)
        if next_sum < minsol:
            print(s.model())
            minsol = next_sum
        forbid = Or([X[i] != sol[i] for i in range(n)])
        s.add(forbid)

    print(minsol)

    first_solutions = [
        42,
        59,
        189,
        85,
        69,
        126,
        53,
        27,
        71,
        310,
        76,
        235,
        212,
        181,
        37,
        110,
        96,
        110,
        75,
        290,
        48,
        12,
        31,
        41,
        223,
        47,
        235,
        244,
        57,
        37,
        185,
        37,
        69,
        63,
        86,
        216,
        69,
        68,
        228,
        35,
        13,
        185,
        248,
        81,
        210,
        95,
        195,
        150,
        272,
        240,
        193,
        66,
        52,
        293,
        54,
        232,
        98,
        74,
        134,
        92,
        58,
        16,
        64,
        64,
        264,
        83,
        115,
        51,
        66,
        54,
        113,
        46,
        52,
        39,
        71,
        158,
        125,
        248,
        46,
        77,
        103,
        259,
        53,
        154,
        106,
        89,
        79,
        70,
        69,
        36,
        125,
        220,
        71,
        49,
        282,
        105,
        41,
        31,
        121,
        66,
        108,
        52,
        72,
        176,
        70,
        236,
        215,
        276,
        216,
        97,
        123,
        25,
        266,
        206,
        258,
        57,
        63,
        28,
        42,
        76,
        103,
        39,
        188,
        111,
        182,
        29,
        50,
        138,
        78,
        14,
        66,
        50,
        222,
        101,
        57,
        206,
        57,
        233,
        183,
        185,
        31,
        70,
        60,
        78,
        75,
        66,
        68,
        67,
        81,
        85,
        79,
        49,
        131,
        196,
        19,
        27,
        53,
        237,
        54,
        29,
        57,
        31,
        274,
        227,
        58,
        65,
        92,
        72,
        52,
        23,
        78,
        36,
        174,
        57,
        55,
        223,
        82,
        50,
        91,
        58,
        220,
        129,
        114,
        106,
        125,
        223,
        36,
        110,
        221,
        42,
        30,
        192,
        49,
        310,
        199,
        48,
        242,
        194,
        227,
        74
    ]

    next_solutions = [
        42,
        59,
        189,
        85,
        69,
        126,
        53,
        27,
        71,
        310,
        76,
        235,
        212,
        181,
        37,
        110,
        96,
        108,
        75,
        290,
        48,
        12,
        31,
        41,
        223,
        47,
        235,
        242,
        57,
        37,
        185,
        37,
        69,
        63,
        86,
        216,
        69,
        67,
        228,
        35,
        13,
        178,
        248,
        81,
        210,
        95,
        195,
        150,
        269,
        240,
        193,
        66,
        45,
        293,
        54,
        232,
        98,
        74,
        134,
        92,
        58,
        16,
        64,
        62,
        264,
        83,
        115,
        47,
        66,
        54,
        111,
        46,
        52,
        39,
        71,
        158,
        125,
        248,
        46,
        77,
        89,
        259,
        47,
        154,
        106,
        89,
        79,
        70,
        69,
        36,
        125,
        220,
        66,
        49,
        260,
        105,
        41,
        31,
        121,
        66,
        108,
        52,
        72,
        176,
        70,
        236,
        196,
        276,
        216,
        97,
        115,
        25,
        266,
        206,
        258,
        57,
        63,
        28,
        42,
        76,
        103,
        39,
        168,
        111,
        182,
        29,
        50,
        126,
        78,
        14,
        66,
        50,
        222,
        101,
        57,
        206,
        57,
        233,
        183,
        185,
        31,
        70,
        60,
        78,
        75,
        66,
        68,
        67,
        81,
        85,
        77,
        49,
        131,
        196,
        19,
        27,
        53,
        237,
        54,
        29,
        57,
        31,
        274,
        227,
        58,
        65,
        92,
        68,
        52,
        23,
        78,
        36,
        174,
        57,
        55,
        223,
        70,
        50,
        91,
        51,
        220,
        124,
        114,
        106,
        125,
        223,
        36,
        110,
        221,
        42,
        30,
        192,
        49,
        277,
        199,
        48,
        218,
        194,
        227,
        74
    ]

    # print(sum(first_solutions))
    # 22655 - too high
    # print(sum(next_solutions))
    # 22432 - still too high

    print("Took " + str(time.perf_counter() - start_time) + " seconds")



# Press the green button in the gutter to run the script.
if __name__ == '__main__':
    main()
